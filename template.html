<!-- 正面内容模板 -->

<div class=qu>—— Question ——</div>
<div class=question>{{QUESTION}}</div>

<script type="text/javascript">
    document.querySelectorAll('.question').forEach((qu) => {
        qu.innerHTML = qu.innerHTML.replace(
            /`((?:.|\r?\n)+?)`/g,
            `<span class="cloze" onclick="toggleCloze(this)">
                <span class="key" style="opacity:0">$1</span>
                <span class="entry" style="display:none;" contenteditable="true"></span>
            </span>`
        );
    });

    function toggleCloze(cloze, allowInput = true, allowSubmitOnEnter = false, allowRepeat = true) {
        const key = cloze.querySelector(".key");
        const entry = cloze.querySelector(".entry");

        if (entry.style.display === "none") {
            if (allowInput) {
                key.style.display = "none";
                entry.style.display = "inline";

                if (allowRepeat) {
                    entry.style.color = "";
                    entry.textContent = "";
                    entry.contentEditable = true;
                }

                if (entry.contentEditable === "true") {
                    entry.focus();
                    attachEntryEvents(entry, key, cloze, allowSubmitOnEnter);
                }
            } else {
                key.style.opacity = 1 - key.style.opacity;
            }
        } else {
            entry.style.display = "none";
            key.style.display = "inline";
        }
    }

    function attachEntryEvents(entry, key, cloze, allowSubmitOnEnter) {
        entry.addEventListener("keydown", (event) => {
            if (event.key === "Backspace") event.stopPropagation();
            if (allowSubmitOnEnter && event.key === "Enter") {
                event.preventDefault(); // 防止回车换行
                entry.blur(); // 提交答案
            }
        });

        entry.onblur = () => {
            const answer = entry.textContent.trim();
            key.style.opacity = 1;
            entry.contentEditable = false;

            if (answer === key.textContent.trim()) {
                entry.style.color = "SeaGreen";
                entry.textContent = `${answer}✔`;
                cloze.onclick = null;
            } else {
                entry.style.color = "IndianRed";
                entry.textContent = `${answer}✘`;
            }
        };
    }

</script>



<!-- 背面内容模板 -->

{{FrontSide}}
<div class=slide>
    {{#ANSWER}}
        <div class=an>—— Answers ——</div>
        <div class=answer>{{ANSWER}}</div>
    {{/ANSWER}}
    {{#TIPS}}
        <div class=Tips><ti>TIPS</ti>{{TIPS}}</div>
    {{/TIPS}}
</div>

<script type="text/javascript">
    document.querySelectorAll('.key').forEach((key) => {
        key.style.opacity = 1;
        key.style.display = "inline";
    });

    document.querySelectorAll('.entry').forEach((entry) => {
        entry.style.display = "none";
    });
</script>



<!-- 样式 -->

<style type="text/css">
    @font-face { font-family: STsong; src: url('_STsong.TTF'); }
    @font-face { font-family: STfangsong; src: url('_STfangsong.TTF'); }
    @font-face { font-family: kt; src: url('_kt.ttf'); }

    .card {
        padding: 15px 20px;
        font-family:STsong, Arial, serif;
        font-size: 25px;
        color: #000;
        background: #ebedec; 
    }

    .qu {
        font: 30px Times;
        font-style: oblique;
        text-align: center;
        margin-bottom: 30px
    }

    .an {
        font: 30px Times;
        font-style: oblique;
        text-align: center;
        margin: 30px 0;
    }

    .question {
        color: #4c5870;
        font-weight: bolder;
        letter-spacing: 0.016em;
        line-height: 150%;
        text-align: justify
    }

    .answer {
        color: #4c5870;
        font-weight: bolder;
        letter-spacing: 0.016em;
        line-height: 150%;
        text-align: justify
    }

    ti{
        border-radius: 10px;
        padding: 4px 5px 4px 5px;
        margin-right: 4px; 
        font: bold 10px Arial;
        text-align: center;
        letter-spacing: 1px;
        color: #ebedec;
        background: #FD7013;
    }

    .Tips{
        min-height: 24px;
        border-top: 1px solid #FD7013;
        padding: 17px;
        white-space: pre-line;
        font-size: 20px;
        line-height: 30px; 
        font-family: STfangsong;
        font-weight: bold;
        text-align: left;
        color: #222831;
        background:#FFFFF2;
        box-shadow: 2px 2px 5px #aaaaaa;
        margin-top: 30px;
    }

    .cloze {
        color: #008792;
        padding:0 10px;
        border-bottom: solid;
        font-family: kt;
        font-weight: bold;
        letter-spacing:0.002em
    }

    .slide {
        position:relative;
        -webkit-animation:slide 2s 0s;
        -webkit-animation-fill-mode:forwards; }

    @-webkit-keyframes slide {
        0%      { opacity: 0;     top: 40px; }
        100%        { opacity: 1;     top: 0px; }
    }


    /* 夜间模式 */

    .card.nightMode {
        color: #ebedec;
        background: #121212;
    }

    .nightMode .question {
        color: #9ba6b2;
    }

    .nightMode .answer {
        color: #9ba6b2;
    }

    .nightMode ti {
        color: #121212;
        background: #f9a825;
    }

    .nightMode .Tips {
        border-top: 1px solid #f9a825;
        color: #ebedec;
        background:#1e1e1e;
        box-shadow: 2px 2px 5px #000000;
    }

    .nightMode .cloze {
        color: #2486b9
    }
</style>
